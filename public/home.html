<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>questionnaire</title>
		<script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.0.0-beta.34/dist/web3.min.js"></script>
		<style>
			body {
				background-color: #eee;
			}

			.main {
				background-color: #fff;
				margin: 0 auto;
				width: 1000px;
				box-sizing: border-box;
				padding: 20px 40px;
				border-radius: 10px;
				display: flex;
				flex-direction: column;
				align-items: center;
			}

			.top {
				display: flex;
				align-items: center;
				justify-content: end;
			}

			.qa-box {
				width: 100%;
			}

			.qa-item {
				width: 100%;
				border: 1px #ccc solid;
				box-sizing: border-box;
				padding: 10px 20px;
				margin-top: 20px;
				border-radius: 10px;
			}

			.qa-title {
				font-size: 24px;
				font-weight: bold;
				margin-bottom: 10px;
			}

			.question span {
				display: block;
				margin-bottom: 10px;
			}

			.question .select {
				display: flex;
				align-items: center;
			}

			.question .select span {
				margin-right: 20px;
			}

			.answer {
				display: flex;
				flex-direction: column;
				align-items: flex-end;
			}

			.answer span {
				width: 177px;
				margin-bottom: 10px;
			}

			input[type="text"] {
				border-radius: 4px;
				line-height: 24px;
				outline: none;
				border: 1px solid #ccc;
				height: 32px;
			}

			.summarization {
				display: flex;
				flex-direction: column;
				width: 100%;
				margin-top: 20px;
			}

			.summarization span {
				display: block;
				margin-bottom: 10px;
				font-weight: bold;
			}

			#sendTransactionBtn {
				margin: 0 auto;
				width: 100px;
				height: 40px;
				line-height: 40px;
				margin-top: 10px;
				border-radius: 4px;
				border: 1px solid #ccc;
				background-color: #fff;
				cursor: pointer;
				font-weight: bold;
			}

			#sendTransactionBtn:active {
				background-color: #ccc;
			}
		</style>
	</head>
	<body>
		<div class="main">
			<div class="top">
				<span>Please connect to your wallet firstğŸ‘‰</span>
				<button id="connectWalletBtn">ConnectWallet</button>
			</div>
			<div class="qa-box">
				<div class="qa-item">
					<div class="qa-title">question1</div>
					<div class="question">
						<span>
							questionquestionquestionquestionquestionquestionquestionquestionquestionquestion
						</span>
						<div class="select">
							<span>A.eee</span>
							<span>B.eee</span>
							<span>C.eee</span>
						</div>
					</div>
					<div class="answer">
						<span>Type your answer here</span>
						<input type="text" id="a" placeholder="Type your answer here">
					</div>
				</div>
				<div class="qa-item">
					<div class="qa-title">question1</div>
					<div class="question">
						<span>
							questionquestionquestionquestionquestionquestionquestionquestionquestionquestion
						</span>
						<div class="select">
							<span>A.eee</span>
							<span>B.eee</span>
							<span>C.eee</span>
						</div>
					</div>
					<div class="answer">
						<span>Type your answer here</span>
						<input type="text" id="b" placeholder="Type your answer here">
					</div>
				</div>
				<div class="qa-item">
					<div class="qa-title">question1</div>
					<div class="question">
						<span>
							questionquestionquestionquestionquestionquestionquestionquestionquestionquestion
						</span>
						<div class="select">
							<span>A.eee</span>
							<span>B.eee</span>
							<span>C.eee</span>
						</div>
					</div>
					<div class="answer">
						<span>Type your answer here</span>
						<input type="text" id="c" placeholder="Type your answer here">
					</div>
				</div>
				<div class="qa-item">
					<div class="qa-title">question1</div>
					<div class="question">
						<span>
							questionquestionquestionquestionquestionquestionquestionquestionquestionquestion
						</span>
						<div class="select">
							<span>A.eee</span>
							<span>B.eee</span>
							<span>C.eee</span>
						</div>
					</div>
					<div class="answer">
						<span>Type your answer here</span>
						<input type="text" id="d" placeholder="Type your answer here">
					</div>
				</div>
				<div class="qa-item">
					<div class="qa-title">question1</div>
					<div class="question">
						<span>
							questionquestionquestionquestionquestionquestionquestionquestionquestionquestion
						</span>
						<div class="select">
							<span>A.eee</span>
							<span>B.eee</span>
							<span>C.eee</span>
						</div>
					</div>
					<div class="answer">
						<span>Type your answer here</span>
						<input type="text" id="e" placeholder="Type your answer here">
					</div>
				</div>
				<div class="qa-item">
					<div class="qa-title">question1</div>
					<div class="question">
						<span>
							questionquestionquestionquestionquestionquestionquestionquestionquestionquestion
						</span>
						<div class="select">
							<span>A.eee</span>
							<span>B.eee</span>
							<span>C.eee</span>
						</div>
					</div>
					<div class="answer">
						<span>Type your answer here</span>
						<input type="text" id="f" placeholder="Type your answer here">
					</div>
				</div>
				<div class="qa-item">
					<div class="qa-title">question1</div>
					<div class="question">
						<span>
							questionquestionquestionquestionquestionquestionquestionquestionquestionquestion
						</span>
						<div class="select">
							<span>A.eee</span>
							<span>B.eee</span>
							<span>C.eee</span>
						</div>
					</div>
					<div class="answer">
						<span>Type your answer here</span>
						<input type="text" id="g" placeholder="Type your answer here">
					</div>
				</div>
				<div class="qa-item">
					<div class="qa-title">question1</div>
					<div class="question">
						<span>
							questionquestionquestionquestionquestionquestionquestionquestionquestionquestion
						</span>
						<div class="select">
							<span>A.eee</span>
							<span>B.eee</span>
							<span>C.eee</span>
						</div>
					</div>
					<div class="answer">
						<span>Type your answer here</span>
						<input type="text" id="h" placeholder="Type your answer here">
					</div>
				</div>
				<div class="qa-item">
					<div class="qa-title">question1</div>
					<div class="question">
						<span>
							questionquestionquestionquestionquestionquestionquestionquestionquestionquestion
						</span>
						<div class="select">
							<span>A.eee</span>
							<span>B.eee</span>
							<span>C.eee</span>
						</div>
					</div>
					<div class="answer">
						<span>Type your answer here</span>
						<input type="text" id="i" placeholder="Type your answer here">
					</div>
				</div>
				<div class="qa-item">
					<div class="qa-title">question1</div>
					<div class="question">
						<span>
							questionquestionquestionquestionquestionquestionquestionquestionquestionquestion
						</span>
						<div class="select">
							<span>A.eee</span>
							<span>B.eee</span>
							<span>C.eee</span>
						</div>
					</div>
					<div class="answer">
						<span>Type your answer here</span>
						<input type="text" id="j" placeholder="Type your answer here">
					</div>
				</div>
				<div class="qa-item">
					<div class="qa-title">question1</div>
					<div class="question">
						<span>
							questionquestionquestionquestionquestionquestionquestionquestionquestionquestion
						</span>
						<div class="select">
							<span>A.eee</span>
							<span>B.eee</span>
							<span>C.eee</span>
						</div>
					</div>
					<div class="answer">
						<span>Type your answer here</span>
						<input type="text" id="k" placeholder="Type your answer here">
					</div>
				</div>
				<div class="qa-item">
					<div class="qa-title">question1</div>
					<div class="question">
						<span>
							questionquestionquestionquestionquestionquestionquestionquestionquestionquestion
						</span>
						<div class="select">
							<span>A.eee</span>
							<span>B.eee</span>
							<span>C.eee</span>
						</div>
					</div>
					<div class="answer">
						<span>Type your answer here</span>
						<input type="text" id="l" placeholder="Type your answer here">
					</div>
				</div>
				<div class="qa-item">
					<div class="qa-title">question1</div>
					<div class="question">
						<span>
							questionquestionquestionquestionquestionquestionquestionquestionquestionquestion
						</span>
						<div class="select">
							<span>A.eee</span>
							<span>B.eee</span>
							<span>C.eee</span>
						</div>
					</div>
					<div class="answer">
						<span>Type your answer here</span>
						<input type="text" id="m" placeholder="Type your answer here">
					</div>
				</div>
				<div class="qa-item">
					<div class="qa-title">question1</div>
					<div class="question">
						<span>
							questionquestionquestionquestionquestionquestionquestionquestionquestionquestion
						</span>
						<div class="select">
							<span>A.eee</span>
							<span>B.eee</span>
							<span>C.eee</span>
						</div>
					</div>
					<div class="answer">
						<span>Type your answer here</span>
						<input type="text" id="n" placeholder="Type your answer here">
					</div>
				</div>
				<div class="qa-item">
					<div class="qa-title">question1</div>
					<div class="question">
						<span>
							questionquestionquestionquestionquestionquestionquestionquestionquestionquestion
						</span>
						<div class="select">
							<span>A.eee</span>
							<span>B.eee</span>
							<span>C.eee</span>
						</div>
					</div>
					<div class="answer">
						<span>Type your answer here</span>
						<input type="text" id="o" placeholder="Type your answer here">
					</div>
				</div>
			</div>
			<div class="summarization">
				<span>Answer summarization</span>
				<input type="text" id="inputData" placeholder="Answer summarization" readonly>
			</div>
			<!-- <div>
			  <label for="inputData">è¾“å…¥æ•°æ®ï¼š</label>
			  <input type="text" id="inputData" />
			</div> -->
			<button id="sendTransactionBtn">Submit</button>
			<div class="summarization">
				<span id="hash"></span>
			</div>
		</div>
		<script>
			// å½“é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œåˆå§‹åŒ–å‡½æ•°
			window.addEventListener('load', init);
			var walletConnect = false;
			var contractAddress = '0xDc7b20dadf2573F9b8687a232A208f246bFd73EB';
			// åˆå§‹åŒ–å‡½æ•°
			async function init() {
				// æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å®‰è£…äº† Metamask
				if (typeof web3 !== 'undefined') {
					// ä½¿ç”¨å·²å­˜åœ¨çš„æä¾›å•†
					web3 = new Web3(web3.currentProvider);
				} else {
					// æç¤ºç”¨æˆ·å®‰è£… Metamask
					alert('è¯·å®‰è£…å¹¶ç™»å½• Metamask');
					return;
				}

				// æ·»åŠ è¿æ¥é’±åŒ…æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶å¤„ç†ç¨‹åº
				const connectWalletBtn = document.getElementById('connectWalletBtn');
				connectWalletBtn.addEventListener('click', connectWallet);

				// æ·»åŠ æ•°æ®ä¸Šé“¾æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶å¤„ç†ç¨‹åº
				const sendTransactionBtn = document.getElementById('sendTransactionBtn');
				sendTransactionBtn.addEventListener('click', sendTransaction);
			}

			// è¿æ¥é’±åŒ…
			async function connectWallet() {
				try {
					// è¯·æ±‚è¿æ¥é’±åŒ…
					await ethereum.request({
						method: 'eth_requestAccounts'
					});
					walletConnect = true
					
					
					console.log('å·²è¿æ¥é’±åŒ…');
					console.log(walletConnect);
					alert('å·²è¿æ¥é’±åŒ…')
				} catch (error) {
					console.error('è¿æ¥é’±åŒ…å‡ºé”™:', error);
				}
			}

			document.addEventListener('DOMContentLoaded', function() {
				// ç›‘å¬ä»aåˆ°oçš„æ¯ä¸ªè¾“å…¥æ¡†çš„å˜åŒ–
				var inputIds = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o'];
				for (var i = 0; i < inputIds.length; i++) {
					document.getElementById(inputIds[i]).addEventListener('input', processInputs);
				}
			});

			function processInputs() {
				// è·å–ä»aåˆ°oçš„æ‰€æœ‰è¾“å…¥æ¡†çš„å€¼
				var values = [];
				var inputIds = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o'];
				for (var i = 0; i < inputIds.length; i++) {
					var value = document.getElementById(inputIds[i]).value;
					if (value.trim() !== '') {
						values.push(value);
					}
				}

				// å°†å€¼ç”¨é€—å·è¿æ¥
				var combinedValue = values.join(',');

				// å°†å¤„ç†åçš„å­—ç¬¦ä¸²èµ‹å€¼ç»™inputData
				document.getElementById('inputData').value = combinedValue;
			}



			// æ•°æ®ä¸Šé“¾
			async function sendTransaction() {
				// è·å–ç”¨æˆ·è¾“å…¥çš„æ•°æ®
				const inputData = document.getElementById('inputData').value;
        console.log(inputData)
				try {
					// è·å–å½“å‰è¿æ¥çš„è´¦æˆ·
					const accounts = await ethereum.request({
						method: 'eth_accounts'
					});
					const from = accounts[0]; // ä½¿ç”¨ç¬¬ä¸€ä¸ªè´¦æˆ·

					// æ„å»ºäº¤æ˜“å¯¹è±¡
					const txObject = {
						from: from,
						to: '0x0000000000000000000000000000000000000000',
						value: 0,
						data: web3.utils.asciiToHex(inputData),
					};

					// å‘é€äº¤æ˜“
					const txHash = await ethereum.request({
						method: 'eth_sendTransaction',
						params: [txObject],
					});

					console.log('äº¤æ˜“å“ˆå¸Œ:', txHash);
					document.getElementById('hash').innerHTML = 'Your Hash:' + txHash;
					alert('Your content has been successfully recorded and an NFT has given you as reward')
					
						
					generateNFT()
				} catch (error) {
					console.error('å‘é€äº¤æ˜“å‡ºé”™:', error);
				}
			}
			
			function getRandomInt(min, max) {
			    min = Math.ceil(min);
			    max = Math.floor(max);
			    return Math.floor(Math.random() * (max - min + 1)) + min;
			}

			function generateNFT() {

				if (!walletConnect) {
					alert('Please connect your wallet first!');
					return;
				}


				var to = window.ethereum.selectedAddress;
				var tokenId = getRandomInt(1000, 9999);
				var uri = 'ipfs://QmTNWS6r3iNN57NSFqfiNZ2WLSGDK6eHY6xzu5vV97hsfN';
				web3 = new Web3();

				const data = web3.eth.abi.encodeFunctionCall({
					name: 'safeMint',
					type: 'function',
					inputs: [{
							type: 'address',
							name: 'to'
						},
						// {
						//     type: 'uint256',
						//     name: 'tokenId'
						// },
						{
							type: 'string',
							name: 'uri'
						}
					]
				}, [to, uri]);

				// Call the Sepolia smart contract
				window.ethereum.request({
					method: 'eth_sendTransaction',
					params: [{
						to: contractAddress,
						from: window.ethereum.selectedAddress,
						data: data, // Function signature for the safeMint method
					}],
				}).then(function(accounts) {
					alert('wait NFT generated');
				}).catch(function(error) {
					alert('Error generating NFT. Please try again.');
				});

			}
		</script>
	</body>
</html>